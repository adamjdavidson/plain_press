<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Filter Pipeline Runs - Plain Press</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    h1 { margin: 0 0 10px; color: #2d5016; }
    .nav-links {
      margin-bottom: 20px;
    }
    .nav-links a {
      color: #2d5016;
      margin-right: 15px;
    }

    .stats {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    .stat-box {
      background: white;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    .stat-box strong { font-size: 24px; color: #2d5016; }
    .stat-box span { display: block; color: #666; font-size: 12px; }

    table {
      width: 100%;
      background: white;
      border-collapse: collapse;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    th {
      background: #2d5016;
      color: white;
      font-weight: 500;
    }
    tr:hover { background: #f9f9f9; cursor: pointer; }

    .status {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
    }
    .status-running { background: #fff3e0; color: #ef6c00; }
    .status-completed { background: #e8f5e9; color: #2e7d32; }
    .status-failed { background: #ffebee; color: #c62828; }

    .pass-rate {
      font-weight: 600;
      padding: 2px 6px;
      border-radius: 4px;
    }
    .rate-high { background: #e8f5e9; color: #2e7d32; }
    .rate-med { background: #fff3e0; color: #ef6c00; }
    .rate-low { background: #ffebee; color: #c62828; }

    .funnel-mini {
      font-family: monospace;
      font-size: 12px;
      color: #666;
    }
    .funnel-mini .arrow { color: #aaa; }

    .no-data {
      text-align: center;
      padding: 40px;
      color: #666;
    }
  </style>
</head>
<body>
  <h1>Filter Pipeline Runs</h1>
  <div class="nav-links">
    <a href="/admin/articles">← Article Admin</a>
    <a href="/admin/sources">RSS Feeds</a>
  </div>

  <div class="stats">
    <div class="stat-box">
      <strong>{{ stats.total_runs }}</strong>
      <span>Total Runs (7 days)</span>
    </div>
    <div class="stat-box">
      <strong>{{ stats.total_processed }}</strong>
      <span>Articles Processed</span>
    </div>
    <div class="stat-box">
      <strong>{{ stats.total_passed }}</strong>
      <span>Articles Passed</span>
    </div>
    <div class="stat-box">
      <strong>{{ "%.1f"|format(stats.avg_pass_rate * 100) }}%</strong>
      <span>Avg Pass Rate</span>
    </div>
  </div>

  {% if runs %}
  <table>
    <thead>
      <tr>
        <th>Started</th>
        <th>Status</th>
        <th>Input</th>
        <th>Funnel</th>
        <th>Final</th>
        <th>Pass Rate</th>
      </tr>
    </thead>
    <tbody>
      {% for run in runs %}
      <tr onclick="window.location='/admin/filter-runs/{{ run.id }}'">
        <td>{{ run.started_at.strftime('%b %d, %H:%M') }}</td>
        <td><span class="status status-{{ run.status.value }}">{{ run.status.value }}</span></td>
        <td>{{ run.input_count }}</td>
        <td class="funnel-mini">
          {{ run.input_count }} 
          <span class="arrow">→</span> {{ run.filter1_pass_count or '?' }}
          <span class="arrow">→</span> {{ run.filter2_pass_count or '?' }}
          <span class="arrow">→</span> {{ run.filter3_pass_count or '?' }}
        </td>
        <td><strong>{{ run.filter3_pass_count or 0 }}</strong></td>
        <td>
          {% set rate = (run.filter3_pass_count or 0) / run.input_count if run.input_count > 0 else 0 %}
          <span class="pass-rate {% if rate >= 0.15 %}rate-high{% elif rate >= 0.08 %}rate-med{% else %}rate-low{% endif %}">
            {{ "%.1f"|format(rate * 100) }}%
          </span>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <div class="no-data">
    <p>No pipeline runs yet.</p>
    <p>Run the daily pipeline to see filter statistics here.</p>
  </div>
  {% endif %}
</body>
</html>

